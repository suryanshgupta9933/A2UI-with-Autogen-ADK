{
  "version": 3,
  "sources": ["../../../../packages/lit/node_modules/signal-utils/src/map.ts"],
  "sourcesContent": ["import { createStorage, type StorageMap } from \"./-private/util.ts\";\n\nexport class SignalMap<K = unknown, V = unknown> implements Map<K, V> {\n  private collection = createStorage();\n\n  private storages: StorageMap<K> = new Map();\n\n  private vals: Map<K, V>;\n\n  private readStorageFor(key: K): void {\n    const { storages } = this;\n    let storage = storages.get(key);\n\n    if (storage === undefined) {\n      storage = createStorage();\n      storages.set(key, storage);\n    }\n\n    storage.get();\n  }\n\n  private dirtyStorageFor(key: K): void {\n    const storage = this.storages.get(key);\n\n    if (storage) {\n      storage.set(null);\n    }\n  }\n\n  constructor();\n  constructor(entries: readonly (readonly [K, V])[] | null);\n  constructor(iterable: Iterable<readonly [K, V]>);\n  constructor(\n    existing?:\n      | readonly (readonly [K, V])[]\n      | Iterable<readonly [K, V]>\n      | null\n      | undefined,\n  ) {\n    // TypeScript doesn't correctly resolve the overloads for calling the `Map`\n    // constructor for the no-value constructor. This resolves that.\n    this.vals = existing ? new Map(existing) : new Map();\n  }\n\n  // **** KEY GETTERS ****\n  get(key: K): V | undefined {\n    // entangle the storage for the key\n    this.readStorageFor(key);\n\n    return this.vals.get(key);\n  }\n\n  has(key: K): boolean {\n    this.readStorageFor(key);\n\n    return this.vals.has(key);\n  }\n\n  // **** ALL GETTERS ****\n  entries(): IterableIterator<[K, V]> {\n    this.collection.get();\n\n    return this.vals.entries();\n  }\n\n  keys(): IterableIterator<K> {\n    this.collection.get();\n\n    return this.vals.keys();\n  }\n\n  values(): IterableIterator<V> {\n    this.collection.get();\n\n    return this.vals.values();\n  }\n\n  forEach(fn: (value: V, key: K, map: Map<K, V>) => void): void {\n    this.collection.get();\n\n    this.vals.forEach(fn);\n  }\n\n  get size(): number {\n    this.collection.get();\n\n    return this.vals.size;\n  }\n\n  [Symbol.iterator](): IterableIterator<[K, V]> {\n    this.collection.get();\n\n    return this.vals[Symbol.iterator]();\n  }\n\n  get [Symbol.toStringTag](): string {\n    return this.vals[Symbol.toStringTag];\n  }\n\n  // **** KEY SETTERS ****\n  set(key: K, value: V): this {\n    this.dirtyStorageFor(key);\n    this.collection.set(null);\n\n    this.vals.set(key, value);\n\n    return this;\n  }\n\n  delete(key: K): boolean {\n    this.dirtyStorageFor(key);\n    this.collection.set(null);\n\n    return this.vals.delete(key);\n  }\n\n  // **** ALL SETTERS ****\n  clear(): void {\n    this.storages.forEach((s) => s.set(null));\n    this.collection.set(null);\n\n    this.vals.clear();\n  }\n}\n\n// So instanceof works\nObject.setPrototypeOf(SignalMap.prototype, Map.prototype);\n"],
  "mappings": ";;;;;;;AAEO,IAAMA,YAAN,MAA+D;EAC5DC,aAAaC,cAAa;EAE1BC,WAA0B,oBAAIC,IAAG;EAEjCC;EAEAC,eAAeC,KAAc;AACnC,UAAM;MAAEJ;IAAS,IAAI;AACrB,QAAIK,UAAUL,SAASM,IAAIF,GAAG;AAE9B,QAAIC,YAAYE,QAAW;AACzBF,gBAAUN,cAAa;AACvBC,eAASQ,IAAIJ,KAAKC,OAAO;IAC3B;AAEAA,YAAQC,IAAG;EACb;EAEQG,gBAAgBL,KAAc;AACpC,UAAMC,UAAU,KAAKL,SAASM,IAAIF,GAAG;AAErC,QAAIC,SAAS;AACXA,cAAQG,IAAI,IAAI;IAClB;EACF;EAKAE,YACEC,UAKA;AAGA,SAAKT,OAAOS,WAAW,IAAIV,IAAIU,QAAQ,IAAI,oBAAIV,IAAG;EACpD;;EAGAK,IAAIF,KAAuB;AAEzB,SAAKD,eAAeC,GAAG;AAEvB,WAAO,KAAKF,KAAKI,IAAIF,GAAG;EAC1B;EAEAQ,IAAIR,KAAiB;AACnB,SAAKD,eAAeC,GAAG;AAEvB,WAAO,KAAKF,KAAKU,IAAIR,GAAG;EAC1B;;EAGAS,UAAoC;AAClC,SAAKf,WAAWQ,IAAG;AAEnB,WAAO,KAAKJ,KAAKW,QAAO;EAC1B;EAEAC,OAA4B;AAC1B,SAAKhB,WAAWQ,IAAG;AAEnB,WAAO,KAAKJ,KAAKY,KAAI;EACvB;EAEAC,SAA8B;AAC5B,SAAKjB,WAAWQ,IAAG;AAEnB,WAAO,KAAKJ,KAAKa,OAAM;EACzB;EAEAC,QAAQC,IAAsD;AAC5D,SAAKnB,WAAWQ,IAAG;AAEnB,SAAKJ,KAAKc,QAAQC,EAAE;EACtB;EAEA,IAAIC,OAAe;AACjB,SAAKpB,WAAWQ,IAAG;AAEnB,WAAO,KAAKJ,KAAKgB;EACnB;EAEA,CAACC,OAAOC,QAAQ,IAA8B;AAC5C,SAAKtB,WAAWQ,IAAG;AAEnB,WAAO,KAAKJ,KAAKiB,OAAOC,QAAQ,EAAC;EACnC;EAEA,KAAKD,OAAOE,WAAW,IAAY;AACjC,WAAO,KAAKnB,KAAKiB,OAAOE,WAAW;EACrC;;EAGAb,IAAIJ,KAAQkB,OAAgB;AAC1B,SAAKb,gBAAgBL,GAAG;AACxB,SAAKN,WAAWU,IAAI,IAAI;AAExB,SAAKN,KAAKM,IAAIJ,KAAKkB,KAAK;AAExB,WAAO;EACT;EAEAC,OAAOnB,KAAiB;AACtB,SAAKK,gBAAgBL,GAAG;AACxB,SAAKN,WAAWU,IAAI,IAAI;AAExB,WAAO,KAAKN,KAAKqB,OAAOnB,GAAG;EAC7B;;EAGAoB,QAAc;AACZ,SAAKxB,SAASgB,QAASS,OAAMA,EAAEjB,IAAI,IAAI,CAAC;AACxC,SAAKV,WAAWU,IAAI,IAAI;AAExB,SAAKN,KAAKsB,MAAK;EACjB;AACF;AAGAE,OAAOC,eAAe9B,UAAU+B,WAAW3B,IAAI2B,SAAS;",
  "names": ["SignalMap", "collection", "createStorage", "storages", "Map", "vals", "readStorageFor", "key", "storage", "get", "undefined", "set", "dirtyStorageFor", "constructor", "existing", "has", "entries", "keys", "values", "forEach", "fn", "size", "Symbol", "iterator", "toStringTag", "value", "delete", "clear", "s", "Object", "setPrototypeOf", "prototype"]
}
